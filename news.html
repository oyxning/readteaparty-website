<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>红茶会MC服务器 - 服务器新闻</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="custom.css">
    <!-- 引入Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .news-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }
        .news-sidebar {
            flex: 1;
            min-width: 250px;
            max-width: 300px;
            background-color: #1e293b;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .news-content {
            flex: 3;
            min-width: 300px;
            background-color: #1e293b;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-height: 80vh;
        }
        .news-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .news-item:hover {
            background-color: #334155;
        }
        .news-item.active {
            background-color: #475569;
        }
        .news-item h3 {
            margin: 0;
            font-size: 18px;
            color: #f8fafc;
        }
        .news-item p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #94a3b8;
        }
        .news-content h2 {
            margin-top: 0;
            color: #f8fafc;
        }
        .news-content .news-meta {
            color: #94a3b8;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .news-content .news-body {
            color: #f1f5f9;
            line-height: 1.6;
        }
        .news-content .news-body h1 {
            font-size: 24px;
            margin-top: 0;
        }
        .news-content .news-body h2 {
            font-size: 20px;
        }
        .news-content .news-body p {
            margin-bottom: 15px;
        }
        .news-content .news-body a {
            color: #3b82f6;
            text-decoration: none;
        }
        .news-content .news-body a:hover {
            text-decoration: underline;
        }
        .no-news {
            text-align: center;
            padding: 50px;
            color: #94a3b8;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <i class="fas fa-cup-tea"></i>
                    <span>红茶会MC</span>
                </div>
                <ul class="nav-links">
                    <li><a href="index.html">首页</a></li>
                    <li><a href="about.html">关于我们</a></li>
                    <li><a href="news.html">服务器新闻</a></li>
                    <li><a href="server_features.html">功能列表</a></li>
                    <li><a href="contact.html">加入我们</a></li>
                </ul>
                <div class="settings">
                    <button id="theme-toggle" class="theme-toggle-btn">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="language-switch">
                        <button class="lang-btn" data-lang="zh">中文</button>
                        <button class="lang-btn" data-lang="en">English</button>
                    </div>
                </div>
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- 管理员提示 -->
    <div class="admin-notice" style="background-color: #fbbf24; color: #1f2937; padding: 10px 20px; text-align: center; font-weight: bold;">
        管理员提示: 本地开发环境下，添加新新闻后请运行 <code>python generate_news_json.py</code> 更新新闻列表。
        GitHub Pages环境下，推送更改后会自动更新。
    </div>

    <!-- 服务器新闻 -->
    <section class="news" id="news" style="padding: 100px 0; margin-top: 70px;">
        <div class="container">
            <h2 class="section-title">服务器新闻</h2>
            <div class="news-container">
                <div class="news-sidebar" id="news-sidebar">
                    <!-- 新闻标题列表将通过JavaScript动态加载 -->
                    <div class="loading">加载中...</div>
                </div>
                <div class="news-content" id="news-content">
                    <div class="no-news">
                        <i class="fas fa-newspaper fa-4x"></i>
                        <p>请从左侧选择一篇新闻</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <i class="fas fa-cup-tea"></i> 红茶会MC
                </div>
                <ul class="footer-links">
                    <li><a href="index.html">首页</a></li>
                    <li><a href="about.html">关于我们</a></li>
                    <li><a href="news.html">服务器新闻</a></li>
                    <li><a href="server_features.html">功能列表</a></li>
                    <li><a href="contact.html">加入我们</a></li>
                </ul>
                <p class="copyright">© 2016 红茶会MC服务器. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // 自动发现news目录下的所有md文件
        async function discoverNewsFiles() {
            // 由于浏览器安全限制，无法直接读取服务器目录
            // 我们使用一个约定：所有新闻文件都列在news.json中
            // 这个文件可以通过服务器端脚本自动生成
            const response = await fetch('json/news.json');
            if (!response.ok) {
                throw new Error('无法加载新闻列表');
            }
            const data = await response.json();
            return data.news;
        }

        // 加载新闻列表
        async function loadNewsList() {
            const sidebar = document.getElementById('news-sidebar');
            sidebar.innerHTML = '<div class="loading">加载中...</div>';

            try {
                // 获取新闻文件列表
                const newsFiles = await discoverNewsFiles();

                // 按照文件日期排序
                newsFiles.sort((a, b) => new Date(b.date) - new Date(a.date));

                // 生成新闻列表
                sidebar.innerHTML = '';
                newsFiles.forEach((file, index) => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item' + (index === 0 ? ' active' : '');
                    newsItem.dataset.file = file.filename;

                    const title = document.createElement('h3');
                    title.textContent = file.title || file.filename.replace('.md', '');

                    const date = document.createElement('p');
                    date.textContent = new Date(file.date).toLocaleDateString();

                    newsItem.appendChild(title);
                    newsItem.appendChild(date);
                    sidebar.appendChild(newsItem);

                    // 添加点击事件
                    newsItem.addEventListener('click', () => {
                        // 移除其他项的active类
                        document.querySelectorAll('.news-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        // 添加active类
                        newsItem.classList.add('active');
                        // 加载新闻内容
                        loadNewsContent(file.filename, file.title, file.date);
                    });
                });

                // 默认加载第一篇新闻
                if (newsFiles.length > 0) {
                    loadNewsContent(newsFiles[0].filename, newsFiles[0].title, newsFiles[0].date);
                } else {
                    sidebar.innerHTML = '<div class="no-news">暂无新闻</div>';
                }
            } catch (error) {
                console.error('加载新闻列表失败:', error);
                sidebar.innerHTML = '<div class="no-news">加载失败</div>';
            }
        }

        // 简单的Markdown解析函数
        function parseMarkdown(markdown) {
            // 解析标题
            markdown = markdown.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            markdown = markdown.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            markdown = markdown.replace(/^### (.*$)/gm, '<h3>$1</h3>');

            // 解析段落
            markdown = markdown.replace(/^(?!<h|<ul|<ol|<li|<pre|<code)(.*$)/gm, '<p>$1</p>');

            // 解析加粗
            markdown = markdown.replace(/\*\*(.*)\*\*/gm, '<strong>$1</strong>');

            // 解析斜体
            markdown = markdown.replace(/\*(.*)\*/gm, '<em>$1</em>');

            // 解析链接
            markdown = markdown.replace(/\[(.*)\]\((.*)\)/gm, '<a href="$2">$1</a>');

            return markdown;
        }

        // 加载新闻内容
        async function loadNewsContent(filename, title, date) {
            const content = document.getElementById('news-content');
            content.innerHTML = '<div class="loading">加载中...</div>';

            try {
                // 直接加载本地md文件
                const response = await fetch(`news/${filename}`);
                if (!response.ok) {
                    throw new Error('无法加载新闻文件');
                }
                const markdownContent = await response.text();

                // 解析Markdown为HTML
                const htmlContent = parseMarkdown(markdownContent);

                // 生成新闻内容
                content.innerHTML = '';

                const newsTitle = document.createElement('h2');
                newsTitle.textContent = title || filename.replace('.md', '');

                const meta = document.createElement('div');
                meta.className = 'news-meta';
                meta.textContent = `发布日期: ${new Date(date).toLocaleDateString()}`;

                const body = document.createElement('div');
                body.className = 'news-body';
                body.innerHTML = htmlContent;

                content.appendChild(newsTitle);
                content.appendChild(meta);
                content.appendChild(body);
            } catch (error) {
                console.error('加载新闻内容失败:', error);
                content.innerHTML = '<div class="no-news">加载失败</div>';

                // 从侧边栏移除无效的新闻条目
                const invalidItem = document.querySelector(`.news-item[data-file="${filename}"]`);
                if (invalidItem) {
                    const sidebar = document.getElementById('news-sidebar');
                    sidebar.removeChild(invalidItem);

                    // 如果还有其他新闻，加载第一个
                    const remainingItems = document.querySelectorAll('.news-item');
                    if (remainingItems.length > 0) {
                        remainingItems[0].classList.add('active');
                        const firstItem = remainingItems[0];
                        loadNewsContent(
                            firstItem.dataset.file,
                            firstItem.querySelector('h3').textContent,
                            firstItem.querySelector('p').textContent
                        );
                    } else {
                        sidebar.innerHTML = '<div class="no-news">暂无新闻</div>';
                    }
                }
            }
        }

        // 页面加载完成后加载新闻列表
        document.addEventListener('DOMContentLoaded', loadNewsList);
    </script>
</body>
</html>